<!doctype html>
<html lang="fr-fr">
  <head>
    <title>Lancer un cron sur un cluster // Tech blog</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.66.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="http://example.org/css/main.min.d59a293bff4cb6f7fcce92a5c9833de7107393f80e4efe3110eea46955464842.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Lancer un cron sur un cluster"/>
<meta name="twitter:description" content="Sur un de mes projets j’ai besoin d’exécuter une tâche tous les jours. Cet exercice pourtant trivial peut devenir plus complexe si mon service utilise plusieurs serveurs et que je ne veux exécuter la tâche qu’une seule fois. En Java j’utilisais le scheduler Quartz pour régler ce problème. Il est très efficace et en cas de cluster il utilise une base de données pour s’assurer que la tâche n’est lancée que sur un seul serveur."/>

    <meta property="og:title" content="Lancer un cron sur un cluster" />
<meta property="og:description" content="Sur un de mes projets j’ai besoin d’exécuter une tâche tous les jours. Cet exercice pourtant trivial peut devenir plus complexe si mon service utilise plusieurs serveurs et que je ne veux exécuter la tâche qu’une seule fois. En Java j’utilisais le scheduler Quartz pour régler ce problème. Il est très efficace et en cas de cluster il utilise une base de données pour s’assurer que la tâche n’est lancée que sur un seul serveur." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/2013/01/07/lancer-un-cron-sur-un-cluster/" />
<meta property="article:published_time" content="2013-01-07T09:39:50+00:00" />
<meta property="article:modified_time" content="2013-01-07T09:39:50+00:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="http://example.org/"><img class="app-header-avatar" src="/avatar.jpg" alt="John Doe" /></a>
      <h1>Tech blog</h1>
      <p>Vieux blog technique</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/sliard" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Lancer un cron sur un cluster</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jan 7, 2013
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div><div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="http://example.org/tags/amazon/">Amazon</a><a class="tag" href="http://example.org/tags/ec2/">EC2</a></div></div>
    </header>
    <div class="post-content">
      <p>Sur un de mes projets j’ai besoin d’exécuter une tâche tous les jours. Cet exercice pourtant trivial peut devenir plus complexe si mon service utilise plusieurs serveurs et que je ne veux exécuter la tâche qu’une seule fois. En Java j’utilisais le <a href="http://quartz-scheduler.org/">scheduler Quartz</a> pour régler ce problème. Il est très efficace et en cas de cluster il utilise une base de données pour s’assurer que la tâche n’est lancée que sur un seul serveur. Mais si votre tâche doit être lancée en shell ? J’ai donc cherché une solution pour le faire simplement sur mon projet utilisant des instances EC2.</p>
<p>Après pas mal de recherches, j’ai trouvé une solution simple sur <a href="http://stackoverflow.com/a/12623737">stackoverflow</a>. L’idée est bonne mais le script ne fonctionne pas (rien que l’utilisation de la commande hostname est étrange…).</p>
<p>J’ai finalement fait fonctionner ce script :</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Il est aussi possible de gérer différemment la gestion de l’authentification AWS en passant par un fichier comme expliqué <a href="http://alestic.com/2010/09/aws-iam">ici</a>.</p>
<p>Ce script doit être exécuté par root. Ensuite il suffit d’ajouter une ligne dans la crontab de vos instances du type :</p>
<blockquote>
<p>02 01 * * * ~/lastonly.rb &amp;&amp; wget -q -O – <a href="http://www.mysite.com/cron/crontasks">http://www.mysite.com/cron/crontasks</a></p>
</blockquote>
<p>Cette solution n’est pas parfaite mais elle a le mérite d’être simple. Une autre solution plus “propre” serait sans doute d’utiliser <a href="http://aws.amazon.com/fr/swf/">Amazon Simple Workflow Service</a></p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
